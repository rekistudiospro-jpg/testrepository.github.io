<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Galería Pro</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
    --azul: #007BFF;
    --fondo: #f5f5f5;
    --texto: #000;
    --card: #ffffff;
}

body.dark {
    --azul: #4da3ff;
    --fondo: #121212;
    --texto: #ffffff;
    --card: #1e1e1e;
}

body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    display: flex;
    height: 100vh;
    background: var(--fondo);
    color: var(--texto);
}

/* Sidebar */
.sidebar {
    width: 220px;
    background: var(--azul);
    color: white;
    padding: 20px;
    display: flex;
    flex-direction: column;
}

.sidebar h2 {
    margin-top: 0;
}

.sidebar button {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 8px;
    cursor: pointer;
}

/* Main */
.main {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 40px;
}

.header button {
    background: var(--azul);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
}

.dropzone {
    margin: 0 40px 20px;
    padding: 20px;
    border: 2px dashed var(--azul);
    border-radius: 12px;
    text-align: center;
}

.galeria {
    flex: 1;
    width: 90%;
    margin: auto;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    overflow-y: auto;
}

.imagen {
    position: relative;
    overflow: hidden;
    border-radius: 15px;
    background: var(--card);
}

.imagen img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: 0.3s;
}

.imagen:hover img {
    transform: scale(1.1);
}

.borrar-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: red;
    color: white;
    border: none;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    cursor: pointer;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    justify-content: center;
    align-items: center;
    z-index: 100;
}

.modal img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 12px;
}

input[type=file] {
    display: none;
}
</style>
</head>
<body>

<div class="sidebar">
    <h2>Menú</h2>
    <button id="toggleDark">Modo oscuro</button>
    <button id="clearAll">Borrar todo</button>
</div>

<div class="main">
    <div class="header">
        <h1>Galería Pro</h1>
        <button id="addPhoto">Añadir foto</button>
    </div>

    <div class="dropzone" id="dropzone">Arrastra imágenes aquí</div>
    <div class="galeria" id="gallery"></div>

    <input type="file" id="fileInput" accept="image/*">
</div>

<div class="modal" id="modal">
    <img id="modalImg" alt="">
</div>

<script>
const gallery = document.getElementById('gallery');
const fileInput = document.getElementById('fileInput');
const modal = document.getElementById('modal');
const modalImg = document.getElementById('modalImg');
const dropzone = document.getElementById('dropzone');

function getGallery() {
    return JSON.parse(localStorage.getItem('gallery')) || [];
}

function saveGallery(arr) {
    localStorage.setItem('gallery', JSON.stringify(arr));
}

function compressImage(file, callback) {
    const reader = new FileReader();
    reader.onload = e => {
        const img = new Image();
        img.onload = () => {
            const canvas = document.createElement('canvas');
            const scale = Math.min(800 / img.width, 1);
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            callback(canvas.toDataURL('image/jpeg', 0.7));
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

function render() {
    gallery.innerHTML = '';
    getGallery().forEach(src => createImage(src));
}

function createImage(src) {
    const div = document.createElement('div');
    div.className = 'imagen';

    const img = document.createElement('img');
    img.src = src;
    img.alt = 'Imagen de la galería';

    img.onclick = () => {
        modalImg.src = src;
        modal.style.display = 'flex';
    };

    const btn = document.createElement('button');
    btn.className = 'borrar-btn';
    btn.textContent = '×';
    btn.onclick = e => {
        e.stopPropagation();
        const arr = getGallery().filter(i => i !== src);
        saveGallery(arr);
        render();
    };

    div.appendChild(img);
    div.appendChild(btn);
    gallery.appendChild(div);
}

/* Eventos */
document.getElementById('addPhoto').onclick = () => fileInput.click();

fileInput.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    compressImage(file, src => {
        const arr = getGallery();
        arr.push(src);
        saveGallery(arr);
        render();
    });
};

dropzone.ondragover = e => e.preventDefault();
dropzone.ondrop = e => {
    e.preventDefault();
    const file = e.dataTransfer.files[0];
    if (file) {
        compressImage(file, src => {
            const arr = getGallery();
            arr.push(src);
            saveGallery(arr);
            render();
        });
    }
};

document.getElementById('clearAll').onclick = () => {
    if (confirm('¿Borrar todas las imágenes?')) {
        localStorage.removeItem('gallery');
        render();
    }
};

document.getElementById('toggleDark').onclick = () => {
    document.body.classList.toggle('dark');
};

modal.onclick = e => {
    if (e.target === modal) modal.style.display = 'none';
};

render();
</script>

</body>
</html>
