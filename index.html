<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mi Galería Local con Sidebar</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        display: flex;
        height: 100vh;
        background-color: #f5f5f5;
    }

    /* --- Sidebar --- */
    .sidebar {
        width: 220px;
        background-color: #007BFF;
        color: white;
        display: flex;
        flex-direction: column;
        padding: 20px;
        box-sizing: border-box;
    }

    .sidebar h2 {
        margin-top: 0;
        font-size: 24px;
        margin-bottom: 20px;
    }

    .sidebar button {
        background-color: rgba(255,255,255,0.2);
        border: none;
        color: white;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 8px;
        cursor: pointer;
        text-align: left;
        font-size: 16px;
        transition: background 0.3s;
    }

    .sidebar button:hover {
        background-color: rgba(255,255,255,0.4);
    }

    .estadisticas {
        margin-top: auto;
        font-size: 14px;
        line-height: 1.5;
    }

    /* --- Contenido principal --- */
    .main {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 50px;
    }

    .titulo {
        font-size: 45px;
        font-weight: 700;
        color: #007BFF;
    }

    .boton-menu {
        position: relative;
        background-color: #007BFF;
        border: none;
        color: white;
        font-size: 30px;
        padding: 5px 15px;
        border-radius: 8px;
        cursor: pointer;
    }

    .desplegable {
        display: none;
        position: absolute;
        top: 50px;
        right: 0;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 0 10px #00000030;
        min-width: 150px;
        z-index: 100;
    }

    .desplegable button {
        width: 100%;
        padding: 10px;
        border: none;
        background: none;
        cursor: pointer;
        text-align: left;
        font-size: 16px;
    }

    .desplegable button:hover {
        background-color: #f0f0f0;
    }

    .galeria {
        width: 90%;
        margin: auto;
        margin-top: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        flex: 1;
        overflow-y: auto;
    }

    .imagen {
        position: relative;
        overflow: hidden;
        border-radius: 15px;
        box-shadow: 0 0 10px #00000030;
        cursor: pointer;
    }

    .imagen img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: 0.3s;
    }

    .imagen img:hover {
        transform: scale(1.1);
    }

    .borrar-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: rgba(255,0,0,0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        font-weight: bold;
        cursor: pointer;
        z-index: 10;
    }

    input[type="file"] {
        display: none;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 200;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.8);
        justify-content: center;
        align-items: center;
    }

    .modal img {
        max-width: 90%;
        max-height: 90%;
        border-radius: 15px;
    }
</style>
</head>
<body>

<div class="sidebar">
    <h2>Menú</h2>
    <button id="btnHome">Home</button>
    <button id="btnBorrarTodo">Borrar todo</button>
    <div class="estadisticas">
        <p id="numFotos">Fotos: 0</p>
        <p id="tamTotal">Tamaño: 0 KB</p>
    </div>
</div>

<div class="main">
    <div class="header">
        <h1 class="titulo">Mi Galería</h1>
        <div style="position: relative;">
            <button class="boton-menu" id="botonMenu">+</button>
            <div class="desplegable" id="desplegable">
                <button id="añadirFoto">Añadir foto</button>
            </div>
        </div>
    </div>

    <div class="galeria" id="galeria"></div>
    <input type="file" id="inputFoto" accept="image/*">

    <div class="modal" id="modal">
        <img id="imagenModal" src="">
    </div>
</div>

<script>
const galeria = document.getElementById('galeria');
const modal = document.getElementById('modal');
const imagenModal = document.getElementById('imagenModal');
const inputFoto = document.getElementById('inputFoto');
const botonMenu = document.getElementById('botonMenu');
const desplegable = document.getElementById('desplegable');

const numFotosElem = document.getElementById('numFotos');
const tamTotalElem = document.getElementById('tamTotal');

const btnHome = document.getElementById('btnHome');
const btnBorrarTodo = document.getElementById('btnBorrarTodo');

// --- Estadísticas ---
function actualizarEstadisticas() {
    let imagenes = JSON.parse(localStorage.getItem('galeria')) || [];
    numFotosElem.textContent = `Fotos: ${imagenes.length}`;

    let totalBytes = imagenes.reduce((acc, img) => {
        // calcular tamaño aproximado del DataURL
        return acc + Math.ceil((img.length - img.indexOf(',') - 1) * 3 / 4);
    }, 0);

    tamTotalElem.textContent = `Tamaño: ${Math.ceil(totalBytes/1024)} KB`;
}

// --- Crear imagen con botón borrar ---
function crearImagen(src) {
    const contenedor = document.createElement('div');
    contenedor.classList.add('imagen');

    const img = document.createElement('img');
    img.src = src;
    img.onerror = () => { img.src = 'https://via.placeholder.com/300?text=Imagen+no+disponible'; }

    img.addEventListener('click', () => {
        imagenModal.src = src;
        modal.style.display = 'flex';
    });

    const btnBorrar = document.createElement('button');
    btnBorrar.textContent = 'X';
    btnBorrar.classList.add('borrar-btn');
    btnBorrar.addEventListener('click', (e) => {
        e.stopPropagation();
        contenedor.remove();
        borrarImagen(src);
        actualizarEstadisticas();
    });

    contenedor.appendChild(img);
    contenedor.appendChild(btnBorrar);
    galeria.appendChild(contenedor);
}

// --- Guardar / borrar / cargar ---
function guardarImagen(src) {
    let imagenes = JSON.parse(localStorage.getItem('galeria')) || [];
    imagenes.push(src);
    localStorage.setItem('galeria', JSON.stringify(imagenes));
}

function borrarImagen(src) {
    let imagenes = JSON.parse(localStorage.getItem('galeria')) || [];
    imagenes = imagenes.filter(i => i !== src);
    localStorage.setItem('galeria', JSON.stringify(imagenes));
}

function cargarImagenes() {
    let imagenes = JSON.parse(localStorage.getItem('galeria')) || [];
    imagenes.forEach(crearImagen);
    actualizarEstadisticas();
}

cargarImagenes();

// --- Desplegable ---
botonMenu.addEventListener('click', () => {
    desplegable.style.display = desplegable.style.display === 'block' ? 'none' : 'block';
});

document.getElementById('añadirFoto').addEventListener('click', () => {
    inputFoto.click();
});

// --- Subir foto ---
inputFoto.addEventListener('change', (e) => {
    const archivo = e.target.files[0];
    if (archivo) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const src = event.target.result;
            crearImagen(src);
            guardarImagen(src);
            actualizarEstadisticas();
        }
        reader.readAsDataURL(archivo);
    }
});

// --- Botón Home ---
btnHome.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
});

// --- Borrar todo ---
btnBorrarTodo.addEventListener('click', () => {
    if (confirm('¿Seguro que quieres borrar todas las fotos?')) {
        localStorage.removeItem('galeria');
        galeria.innerHTML = '';
        actualizarEstadisticas();
    }
});

// --- Cerrar desplegable al click fuera ---
document.addEventListener('click', (e) => {
    if (!botonMenu.contains(e.target) && !desplegable.contains(e.target)) {
        desplegable.style.display = 'none';
    }
});

// --- Cerrar modal ---
modal.addEventListener('click', (e) => {
    if (e.target === modal) modal.style.display = 'none';
});
</script>

</body>
</html>
